<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Index-capture by jnu</title>
    
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Index-capture</h1>
        <p>Bookmarklet for quickly archiving directories</p>
        <p class="view"><a href="https://github.com/jnu/index-capture">View the Project on GitHub <small>jnu/index-capture</small></a></p>
        <ul>
          <li><a href="https://github.com/jnu/index-capture/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/jnu/index-capture/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/jnu/index-capture">Fork On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>index-capture</h1>

<p>A bookmarklet for quickly archiving directories.</p>

<h2><a name="updates">RECENT (NOTEWORTHY) UPDATES</a></h2>
<ul>
<li>4/26/2012 - I'm proud to say I've replaced <a href="http://stuartk.com/jszip/">JSZip</a> with a SWF object employing <a href="http://nochump.com/blog/archives/15">nochump</a>. Now archives can now exceed more than a megabyte (haven't found an upper bound yet, but the largest I've tried is ~8MB). This has created some
issues with misfires in large downloads that hopefully will be resolved soon.
</ul>

<h2><a name="about">ABOUT</a></h2>

<p>This bookmarklet provides a utility for archiving a list of pages from a directory. The project was motivated by the need to download a large number of webpages (in my case, basketball statistics) to store for further processing. I used to use <a href="http://www.iopus.com/imacros/firefox/">iMacros</a> for such purposes, but I realized that for the simple case of downloading all links in a directory, iMacros was overkill. It seemed a simpler, quicker, and more elegant approach to write a piece of JavaScript that can be launched from a bookmarklet to traverse the index and create an archive. So that's what I wrote. I'm in the process of adding more features (i.e., ruining the elegance of simplicity) to make the code more robust.</p>

<h2><a name="installation">INSTALLATION</a></h2>

<p>Install the bookmarklet by copying and pasting the minified JavaScript into the location field of a new bookmark in your favorite browser. Note that I am assuming Google Chrome is your favorite browser (see <a href="#compatibility">COMPATIBILITY</a>).</p>

<h2><a name="usage">USAGE</a></h2>

<p>Navigate to a directory containing a list of links to pages you wish to archive. Select one of these links. Execute the bookmarklet. The tool will load its control panel (this might take a few seconds) and attempt to discern all the links on the page that are similar to the one you've selected. It will inform you of its findings in the input box in the left side of the panel. This is a CSS selector, identical to what you're accustomed to using in jQuery (it uses the selector in this box verbatim to select the links on the page). You can test whether the selector is what you're looking for by hovering your mouse over the "TEST" text on the control panel. This will highlight the links that are selected by this selector. You can adjust the path as needed to get all the links you need (and hopefully no more). The tool comes with James Padolsey's excellent <a href="http://james.padolsey.com/javascript/regex-selector-for-jquery/">:regex selector</a> installed, so you can use this if you need some more power. Press "GO". The downloader panel will launch.</p>

<p>In the downloader panel, you'll see a list of the links you intend to download. You have the option of this point of whittling down the list a bit more by using regular expressions targeted at either the href or the link text (more on this in <a href="#regexfilters">REGEX FILTERS</a>). Once you've gotten the list just as you want it, press "Download." The downloading will commence. When the archive is prepared, the "Save" button will appear. Press this button and save the archive to the location of your choice. (Future versions may eliminate these extra button clicks.)</p>


<h2><a name="regexfilters">REGEX FILTERS</a></h2>

<p>You can filter a links queue in the downloader panel using targeted regular expressions. In particular, you can target either the href or the link text, or both. The syntax is as follows:</p>

<p>In the tags input box, enter regular expressions in the typical manner, delimited by / /. Targetting flags must be prefixed to this expression with a colon, e.g.: "ru:/^mailto:/i" (with no quotation marks) will create a filter for anything in the mailto: URI, which would be useful if you were trying to download a list of biographies, but the (poorly designed) webpage had their email addresses contained within the same element as the bio link. </p>

<p>Possible targetting flags (use one of the top two with one of the bottom three; omitted flags revert to default):</p>

<ul>
<li>t    "Text" - Tag is actually text, don't interpret it as RegExp</li>
<li>r    "RegExp" - Tag is RegExp, interpret it as such (default).</li>
<li>---</li>
<li>u    "URL" - Target the href</li>
<li>d    "Displayed" - Target the displayed text of the link</li>
<li>b    "Both" - Target both href and displayed text (default).</li>
</ul>

<h2><a name="details">DETAILS, ISSUES, &amp; LIMITATIONS</a></h2>

<p>This was the first time I've written in anything substantial in JavaScript in about 10 years. I was amazed by all 
  of the libraries that are currently available that made writing this code so much easier. I was also
  overwhelmed by all the libraries and I'm sure I've missed a few that would have saved me some time and energy.
  Additionaly, until this project I was blissfully ignorant of how to do anything in ActionScript. After a couple of
  days trying to sort it all out, I'll say that while AS itself is essentially trivially different from JavaScript,
  learning how to make the parts of a Flash movie come together into a simple .swf somehow ended up being one of the
  most painful experiences in all my days coding (right up there with the parenthetical nightmares I had while learning
  Lisp). Anyway, fleeting is the memory of pain and everything works now. With the following limitations:
  </p>

<ul>
<li><p>This script previously used Stuart Knightley's JSZip library to do client-side archiving. This had serious 
  limitations on the maximum possible size of the archives and on the options for downloading the archive. I'm happy 
  to say these limitations have been mitigated by using ActionScript to perform the zipping in lieu of JavaScript. I 
  am now using dchang's <a href="http://nochump.com/blog/archives/15">nochump</a> library to do zipping. A nice 
  side-effect of this is that I am also using Flash to execute the download of the archive, and Flash allows the user 
  to select a location and name for the download (cf. Doug Neiner's <a href="https://github.com/dcneiner/Downloadify">Downloadify</a>,
  which I am <i>not</i> using but is generally a very useful library). Of course, there are some kinks that need ironing:
  on large downloads (several hundred pages), up to 10% of the pages fail to be archived. I hope to fix this soon.
  Additionally, nochump is a rather old library and there are surely performance improvements to be made. Resolving
  that issue is not a priority of mine, but maybe if I get bored this summer.
</p></li>
<li><p>bootstrap.js -- I wrote this little library to defeat the race condition that crops up when you try to load multiple interdependent JavaScript libraries from a bookmarklet. It's just a chain loader that accepts a queue of scripts (or stylesheets, even though their order doesn't (ever?) matter) and loads them sequentially. More interestingly, it is meant to avoid conflicts with multiple versions of libraries such as jQuery. The idea is that the bookmarklet should not break any of the functionality of the target page, which overwriting the target page's version of a library with a different one could very easily do. Sadly, there is at least one problem with this code, though I haven't quite figured out what it is (it breaks when trying to install certain jQuery plugins). It seems like another race condition, which is unsurprising. I hope to get this fixed soon.</p></li>
<li><p>Cross-domain issues. One motivation for writing a bookmark for this was that it would allow for downloading the links incredibly easily by using AJAX requests AS LONG AS THE LINKS ARE ON THE SAME DOMAIN AS THE INDEX PAGE. Your browser will forbid you from completing cross-domain AJAX requests pursuant to the same-origin policy. As a result, this bookmarklet is not ideal for downloading things like SERPs. Of course, anything is possible: if you are desperate, scoot around the SOP in the usual way, by loading the target page through a proxy and running the bookmarklet there.</p></li>
</ul><p>Apart from those bugs, the source at the moment is sloppy and unrefined. There are some vestigial methods that unnecessarily clutter the $.fn namespace. Hopefully I'll have time to do some tidying up soon.</p>

<h2><a name="compatibility">COMPATIBILITY</a></h2>

<p>The idea of this project, as is the goal of every good project, is to be entirely cross-browser compatible. So far I have only been testing in Chrome. I tried running it in Firefox and I got a cleared-scope error. I know what is causing this, but I haven't been able to solve the problem yet. I know there will be issues with installing the bookmarklet in older versions of IE, since the bookmarklet currently exceeds their size limitations. I have no idea whether the bookmarklet will run on Opera or Safari or new IE.</p>

<h2><a name="future">FUTURE</a></h2>

<p>The user will notice a couple of checkboxes on the panel right now, saying "Sub-index?"
and "Url-Macro?" These reflect future features. They are in development, so don't
try to use them. The former will allow you to traverse sub-directories: for example,
if a directory page has an alphabetical index of sub-directories and does not allow
you to see all of its contents at once, you will still be able to archive everything
by defining two (or more) levels of traversal. The "Url-macro?" feature will allow
you to input a URL-template such as "<a href="http://www.example.com/?a=%7B1%7D">http://www.example.com/?a={1}</a>" and a range
such as "A-Z" in order to traverse sub-directories more programmatically (which 
is sometimes necessary in order to pass other options to the server such as "show
all"). THESE CAPABILITIES ARE IN PROGRESS! HOPEFULLY THEY WILL BE FINISHED SOON!</p>

<h2><a name="demo">DEMO</a></h2>

<p>Demonstration archiving a list of postings on Craigslist. (Mute the audio, it's just "All Things Considered." Sorry about that.)<p>
<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="800" height="600" id="movie_name" align="middle">
    <param name="movie" value="swf/index-capture_alpha_demo1.swf"/>
    <!--[if !IE]>-->
    <object type="application/x-shockwave-flash" data="swf/index-capture_alpha_demo1.swf" width="800" height="600">
        <param name="movie" value="swf/index-capture_alpha_demo1.swf"/>
    <!--<![endif]-->
        <a href="http://www.adobe.com/go/getflash">
            <img src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Get Adobe Flash player"/>
        </a>
    <!--[if !IE]>-->
    </object>
    <!--<![endif]-->
</object>

<p>More detailed information is available in the source. I will be extracting and consolidating these documentations in the near future.</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/jnu">jnu</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>