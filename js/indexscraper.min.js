/* Copyright 2012 Joseph Nudell - Released under GNU GPL v.3 - See http://jnu.github.com/index-capture for details */
function fromAS(a){return}function FilterTag(a){this.raw=a;this._modeflags="";this.search_url=true;this.search_text=true;this.text="";this.reflags="";this.pattern=new RegExp(this.text,this.reflags);var b=a.split(":");if(b.length==1){this.text=b[0];this.pattern=new RegExp(b[0],this.reflags)}else{this._modeflags=b[0];b[0]="";this.text=b.join("");if(this._modeflags.length>2)throw"ModeFlagLengthError";if(/[^rtudb]/.test(this._modeflags))throw"ModeFlagValueError";if(/r/.test(this._modeflags)&&/t/.test(this._modeflags))throw"ModeFlagValueConflictError";if(/u/.test(this._modeflags)&&/d/.test(this._modeflags)||/u/.test(this._modeflags)&&/b/.test(this._modeflags)||/d/.test(this._modeflags)&&/b/.test(this._modeflags))throw"ModeFlagValueConflictError";if(/r/.test(this._modeflags)){reparts=this.text.match(/^\/(.+)\/([^\/]*)$/);if(reparts==null)throw"FilterTagRegExpError";this.pattern=new RegExp(reparts[1],reparts[2])}if(!/u|b/.test(this._modeflags)){this.search_url=false}if(!/d|b/.test(this._modeflags)){this.search_text=false}}this.matches=function(a){_m=false;if(this.search_text)_m=_m||this.pattern.test(a.innerHTML);if(this.search_url)_m=_m||this.pattern.test(a.href);return _m}}var installScraper=function(a){(function(a){a.fn.createControlPanel=function(b,c,d,e,f){if(typeof d=="undefined")d=function(){return false};if(typeof e=="undefined")e=window.location.href;if(typeof f=="undefined")f="";if(a("#indexScraper_controlPanel").length<1){if(typeof b=="undefined")b=["http://jnu.github.com/index-capture/css/controlpanel.css"];if(typeof c=="undefined")c=[];BS.styles=b;BS.scripts=c;BS.loadStyles(BS.styles);var g=document.createElement("div");g.setAttribute("id","indexScraper_controlPanel_contain");g.innerHTML='<div id="indexScraper_controlPanel" class="ui-widget ui-corner-bottom ui-widget-header"></div>';document.getElementsByTagName("body")[0].appendChild(g);a("#indexScraper_controlPanel").html("<form id='cp_form'><div id='urlfields'><input type='text' id='url' class='ui-corner-all ui-form-default' /><input type='text' id='urlpattern' class='ui-form-default ui-corner-all' /></div><span id='pathbox'><input type='text' id='path' class='ui-form-default ui-corner-all' /></span><span id='test'>TEST</span><input type='submit' id='go' value='Go' class='ui-form-default' /><span id='subchk'><input type='checkbox' id='subindex' class='ui-form-default' />Sub-index?</span><span id='urlchk'><input type='checkbox' id='urlmacro' class='ui-form-default' />Url Macro?</span><input type='hidden' id='main_index' value='"+e+"' /><ol id='paths' style='visibility:hidden'>"+f+"</ol></form>");a("#indexScraper_controlPanel #test").css("left",a("#indexScraper_controlPanel #go").offset().left+a("#indexScraper_controlPanel #go").width()+50+"px");a("#indexScraper_controlPanel #go").button();a("#indexScraper_controlPanel").height("34px");a("#indexScraper_controlPanel #urlfields").hide();a("#indexScraper_controlPanel #urlmacro").click(function(){if(a(this).is(":checked")){a("#indexScraper_controlPanel #urlfields").css({top:a("#indexScraper_controlPanel").height()+"px",position:"absolute",left:"5px"});if(a("#indexScraper_controlPanel #url").val()=="")a("#indexScraper_controlPanel #url").val(window.location.href);a("#indexScraper_controlPanel #urlfields").fadeIn("fast",function(){a("#indexScraper_controlPanel").height(a("#indexScraper_controlPanel").height()+a("#indexScraper_controlPanel #urlfields").height())})}else a("#indexScraper_controlPanel #urlfields").fadeOut("fast",function(){a("#indexScraper_controlPanel").height(a("#indexScraper_controlPanel #path").height()+8)})});a("#indexScraper_controlPanel #cp_form").submit(function(){var b=a("#indexScraper_controlPanel").path();a("#indexScraper_controlPanel #paths").append("<li>"+b+"</li>");if(a("#indexScraper_controlPanel #urlmacro").is(":checked")){var c=a("#indexScraper_controlPanel #urlpattern").explodePattern();var f=new Array;for(var g in c)f.push(a("#indexScraper_controlPanel #url").val().replace(/\{1\}/,c[g]));a("#indexScraper_controlPanel").createLoaderWithLinks(f)}else{if(a("#indexScraper_controlPanel #subindex").is(":checked")){var h=a("#indexScraper_controlPanel #paths").html();var i=a(b)[0].href;a("#indexScraper_controlPanel #url").val(i);a.get(i,function(b){document.open();document.write(b);document.close();a("body").createControlPanel(style_url,d,e,h)})}else{a("#indexScraper_controlPanel").createLoaderWithLinks()}}return false});a("#indexScraper_controlPanel #test").hover(function(){a(a("#indexScraper_controlPanel").path()).each(function(b,c){if(c.tagName=="A")a(c).toggleClass("ixsc_highlight");else a(c).each.find("a").toggleClass("ixsc_highlight")})})}return a("#indexScraper_controlPanel")};a.fn.path=function(a){if(typeof a=="undefined"){return this.find("#path").val()}else{this.find("#path").val(a);return this}};a.fn.createLoaderWithLinks=function(b){function j(b,c){if(b.length==1){var d="";a(b[0]).each(function(b,c){if(c.nodeName!="A"){a(c).find("a").each(function(b,c){var e=document.createElement("a");e.href=c.href;e.innerHTML=c.innerHTML;d+='<div><a href="'+e.href+'">'+a(e).text()+"</a></div>"})}else{var e=document.createElement("a");e.href=c.href;e.innerHTML=c.innerHTML;d+='<div><a href="'+e.href+'">'+a(e).text()+"</a></div>"}});if(typeof c!="undefined"){c(d)}else{return d}}else{var f=a(b[0]).length;var g=b.splice(1);var h=0;a(b[0]).each(function(b,d){a.get(d.href,function(a){document.open();document.write(a);document.close();e+=j(g);h+=1;if(h==f&&typeof c!="undefined"){c(e)}})})}}var c=this.find("#main_index").val();var d=c.match(/(?:ht|f)tps?:\/\/(?:www\d*\.)?([\d\w\-]+?)\./i);if(d)d=d[1];else d="dl";var e='<a href="'+c+'">index</a>';var f=[];if(typeof b!="undefined"){var g=new Array;for(var h in b){var i=document.createElement("a");i.href=b[h];g.append(i)}f.push(g)}this.find("#paths li").each(function(b,c){f.push(a("<div/>").html(c.innerHTML).text())});var k=function(){j(f,function(b){b='<div><a href="'+window.location.href+'">INDEX</a></div>'+b;var c='(function($){$("#download").click(function() { var name = ($("#name").val()!="")? $("#name").val() : "download"; $("#queue").submitLinkDownloadRequest(name);}); $("#filter").button(); $("#filter").click(function() { $("#queue").filterLinks("#tagsbox .tag span"); $("#count span").text($("#queue").find("a").length-1); }); $("#tags").tagsInput(); $("#count span").text($("#queue").find("a").length-1);})(BS.$);';var e='<div id="upper"><div id="count">Found <span></span> links (not counting index itself)</div><input type="text" id="name" value="'+d+'" /><div><button id="filter">Filter Results</button><div id="tagsbox"><input name="tags" id="tags" /></div></div><button id="download">Download</button></div><div id="queue">'+b+'</div><script type="text/javascript">'+c+"</script>";BS.styles.push("http://jnu.github.com/index-capture/css/jquery.tagsinput.css");BS.loadStyles(BS.styles);BS.scripts.push("jQueryPlugin:http://jnu.github.com/index-capture/js/jquery.tagsinput.min.js");BS.loadLibs(BS.scripts,function(){BS.$("body").append('<div id="downloader_panel"/>');BS.$("#downloader_panel").dialog({height:"auto",width:"400px",closeOnEscape:true,minHeight:"300px",modal:true,autoOpen:true,title:"Downloader",position:"top"});BS.$("#downloader_panel").parent().css("top",a("indexScraper_controlPanel").height()+50);BS.$("#downloader_panel").html(e);BS.$("#download").button();BS.$("#downloader_panel").append('<div id="indexCapture_icHelper"><p>You must update your Flash player!</p></div>');var b={},c={},d={};c.allowscriptaccess="always";c.allownetworking="all";d.id="ichelper";swfobject.embedSWF("http://jnu.github.com/index-capture/flash/ichelper.swf","indexCapture_icHelper","140","30","10.0.0",false,b,c,d);a("#ichelper").css("visibility","hidden")})})};if(f.length>1){a.get(c,function(a){document.open();document.write(a);document.close();k()})}else{k()}};a.fn.submitLinkDownloadRequest=function(b,c){if(typeof b=="undefined")b="dl";if(typeof c=="undefined")c=false;a("#downloader_panel #upper").html('<div id="progressbar"/>');a("#downloader_panel #progressbar").progressbar();a("#ichelper")[0].createZip(b);var d=function(b,c){var d=0;var e=b.find("a").length;b.find("a").each(function(b,f){a.get(f.href,function(b){var g=f.innerText.replace(/[^a-z0-9]/ig,"");var h=0;var i=5;while(!a("#ichelper")[0].addFileToZip(g,b)&&h++<i){console.log("Error adding '"+g+"' to zip. Retrying ("+h+") ...")}d+=1;if(h==i){a(f).css("color","#f00")}else{a(f).fadeOut("fast")}var j=d/e*100;a("#downloader_panel #progressbar").progressbar("value",j);if(j==100){if(typeof c!="undefined")return c();else return}})})};d(this,function(){a("#downloader_panel #progressbar").progressbar("value",100);a("#downloader_panel").css("text-align","center");var b=a(".ui-widget-content").css("background-color").split(/',\s*'/);if(b.length>=3){var c=new Array(3);for(var d=0;d<3;d++){c[d]=parseInt(b[d].replace(/[^\d]/g,"")).toString(16);while(c[d].length<2)c="0"+c[d]}var e=parseInt(c.join(""),16);a("#ichelper")[0].setBGColor(e)}a("#ichelper").css({visibility:"visible","margin-top":"15px"});a("#ichelper")[0].generateZip()});return null};a.fn.makeLinksAbsolute=function(b){if(!/\/$/.test(b)){if(/\?/.test(b)||!/\/.+\.[\w\d_\-]+$/.test(b))b=b.split("?")[0].split("/").slice(0,-1).join("/");b+="/"}this.find("a").each(function(c,d){var e=a(d).attr("href");if(!/^https?:\/\//i.test(e)){if(/^\//.test(e))e=e.substr(1,e.length);a(d).attr("href",b+e)}});return this};a.fn.filterLinks=function(b){var c=new Array(0);a(b).each(function(a,b){raw_text=b.innerHTML.replace(/Â /g," ").replace(/^\s+|\s+$/g,"");c.push(new FilterTag(raw_text))});this.find("a").each(function(b,d){for(var b=0;b<c.length;b++){if(c[b].matches(d)){a(d.parentNode).remove();break}}});return this};a.fn.getSelectedElement=function(){var a=null;try{a=this[0].getSelection().getRangeAt(0).commonAncestorContainer;while(a.nodeType!=1)a=a.parentNode}catch(b){a=document.body}return a};a.fn.getPath=function(a){var b="";if(this.length!=1)throw"Requires one element.";if(typeof a=="undefined")a=false;var c,d=this;while(d.length){var e=d[0],f=e.localName;if(!f)break;f=f.toLowerCase();if(e.id){b=f+"#"+e.id+(c?">"+c:"");break}else if(e.className){f+="."+e.className.split(/\s+/).join(".")}var g=d.parent(),h=g.children(f);if(h.length>1){var i="eq";var j=0;switch(f){case"div":i="eq";j=h.index(d);break;default:i="nth-child";j=h.index(d)+1;break}f+=":"+i+"("+j+")"}c=f+(c?">"+c:"");d=g}if(b.length==0)b=c;return a?guessList(b,this.closest("body")):b};a.fn.displayList=function(a,b){if(typeof b=="undefined")b="li";this.empty();for(var c=0;c<a.length;c++){var d=document.createElement(b);d.appendChild(a[c]);this.append(d)}return this};a.fn.explodePattern=function(){var a=new Array;var b=this.val();var c=b.split(/,/);var d={alpha_l:"abcdefghijklmnopqrstuvwxyz",alpha_u:"ABCDEFGHIJKLMNOPQRSTUVWXYZ",num:"0123456789"};for(var e in c){if(/\-/.test(c[e])){var f=c[e].split(/\-/);if(f.length!=2)return false;var g=f[0],h=f[1];for(var i in d){if(RegExp(g).test(d[i])&&RegExp(h).test(d[i])){range=d[i].split("");for(var j=d[i].indexOf(g);j<=d[i].indexOf(h);j++)a.push(range[j]);break}}}else{a.push(c[e])}}return a};window.guessList=function(b,c){if(typeof c=="undefined")c=document;var d=b.split(">");var e=b,f=0;for(var g=d.length;g>0;){if(d[--g].indexOf(":nth-child")>-1||d[g].indexOf(":eq")>-1){var h=d[g];var i=d[g].split(":")[0];d[g]=i;newpath=d.join(">");var j=a(newpath,c);if(j.length>f){e=newpath;f=j.length}d[g]=h}}return e}})(a);a.extend(a.expr[":"],{regex:function(a,b,c){var d=c[3].split(","),e=/^(data|css):/,f={method:d[0].match(e)?d[0].split(":")[0]:"attr",property:d.shift().replace(e,"")},g="ig",h=new RegExp(d.join("").replace(/^\s+|\s+$/g,""),g);return h.test(jQuery(a)[f.method](f.property))}})};window.indexScraperLoaded=true